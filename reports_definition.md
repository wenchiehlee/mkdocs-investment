# Generated Reports Specification

This document defines the requirements, structure, and styling for all automated reports generated by `Python-Actions.GoodInfo.Analyzer` for the `mkdocs-investment` project.

**Goal:** Ensure consistent styling, interactive features (sorting/filtering/zooming), and correct MkDocs integration across all report types.

---

## 1. General Requirements (All Reports)

### 1.1 Frontmatter (YAML)
All generated Markdown files MUST start with standard MkDocs frontmatter:

```yaml
---
authors: [wenchiehlee]
date: YYYY-MM-DD
categories: [Category1, Category2]
tags: [Tag1, Tag2, Á∏ΩË¶Ω]
title: üìä Report Title
comments: false
draft: false
description: Brief description of the report
---
```

### 1.2 Style Injection
Include the following CSS block after the frontmatter to ensure table font sizing aligns with the theme:

```html
<style>
.sortable-table, .sortable-table td, .sortable-table th {
    font-size: var(--md-text-size) !important;
}
</style>
```

### 1.3 Table Wrapper & Class
*   **Wrapper:** All main data tables MUST be wrapped in `<div class="annotate" markdown> ... </div>` to trigger the DataTables initialization script (`tables.js`).
*   **Class:** The table itself can optionally have `class="sortable-table"`, though the script adds it automatically if the wrapper is present.

### 1.4 Link Format
Internal links (e.g., to individual stock reports) MUST follow this format to work with the custom DataTables renderer:
*   **Syntax:** `[**Code**](../path/to/report/)`
*   **Important:**
    *   Use Markdown syntax `[]()`.
    *   **Bold** the text inside the brackets: `[**2330**]`. This matches the regex in `tables.js`.
    *   Use `../` prefix and trailing slash `/` for directory-based URL resolution (e.g., `../stage2-cleaning-revenue-report/stage2-cleaning-revenue-report-2330/`).

### 1.5 Header Emojis
Use Unicode emojis (e.g., üì¶, üè¶) or MkDocs-compatible shortcodes (e.g., `:chart:`) in table headers.

---

## 2. Report Specifics

### 2.1 Revenue Report (`stage2-cleaning-revenue-report-all.md`)
*   **Columns:** 6 Columns.
*   **Key Detection:** Standard `tables.js` logic for 6-column tables.
*   **Format:**
    1.  `[**Code**](...)` (Link)
    2.  Name
    3.  Data Count (Numeric)
    4.  Latest Month (YYYY/MM)
    5.  YoY (Colored HTML Span)
    6.  Data Range

### 2.2 Dividend Report (`stage2-cleaning-dividends-report-all.md`)
*   **Columns:** 10 or 12 Columns.
*   **Key Detection:** Header must contain "ÁèæÈáëËÇ°Âà©".
*   **Features:** "Minimum Yield" custom filter.
*   **Filter Logic:** Script searches for column header containing "ÊÆñÂà©Áéá" AND "Áï∂Êó•".
*   **Format (12-Col Example):**
    1.  `[**Code**](...)`
    2.  Name
    3.  Cash Dividend (Num)
    4.  Predict (Num)
    5.  TTM Predict (Num)
    6.  Factset Predict (Num)
    7.  Yield @ Current (Percentage)
    8.  Time
    9.  Yield @ Low (Percentage)
    10. Yield @ High (Percentage)
    11. Payout Ratio (Percentage)
    12. Stability (Num + Emoji)

### 2.3 Margin Daily Report (`stage2-cleaning-margin_daily-report-all.md`)
*   **Columns:** 8 Columns.
*   **Key Detection:** Header must contain "ËûçË≥áÈ§òÈ°ç".
*   **Features:** "Ratio" custom filter.
*   **Filter Logic:** Script searches for column header containing "ÊØîÁéá".
*   **Format:**
    1.  `[**Code**](...)`
    2.  Name
    3.  Margin Balance (Num)
    4.  Close Price (Num)
    5.  Market Cap (Num - Custom parser for ÂÖÜ/ÂÑÑ)
    6.  Ratio (Percentage)
    7.  Risk (Emoji)
    8.  Date

#### 2.3.1 Interactive Charts (Margin Report Details)
For individual stock reports (`stage2-cleaning-margin_daily-report-XXXX.md`), replace static SVGs with interactive charts.

1.  **Data Generation:**
    *   Generate a JSON file: `margin_daily-{stock_id}.json`.
    *   **Content:** JSON Array of Arrays `[[timestamp_ms, value], ...]`.
2.  **Markdown Template:**
    *   Use a placeholder `div` instead of `![](.svg)`.
    *   **Syntax:**
        ```html
        <div class="margin-chart" data-url="../margin_daily-{stock_id}.json" data-title="ËûçË≥áÈ§òÈ°ç"></div>
        ```

### 2.4 ROA/ROE Report (`stage2-cleaning-roa-roe-report-all.md`)
*   **Columns:** 6 Columns (Code, Name, Industry, ROE, ROA, Link/Range).
*   **Key Detection:** Headers must contain "ROE" and "ROA".
*   **Refinement Requirements:**
    *   Match Revenue Report style (Frontmatter, Overview Cards, Styles).
    *   **Table:** Wrap in `<div class="annotate" markdown>`.
    *   **Link:** Move link to the first column `[**Code**](...)`.
    *   **Headers:** Use emojis (e.g., `:identification_card:`, `:factory:`, `:chart:`).

---

## 3. Implementation Checklist for Generator

- [ ] **JSON Output:** Update analyzer to save `margin_daily-*.json`.
- [ ] **Chart Template:** Update Margin Report template to output `<div class="margin-chart" ...>`.
- [ ] **ROA/ROE Revamp:**
    - [ ] Add Frontmatter & Styles.
    - [ ] Add Summary Cards.
    - [ ] Wrap table in `.annotate`.
    - [ ] Update table headers with emojis.
    - [ ] Fix link format to `[**Code**](path)`.
- [ ] **Verify Links:** Ensure all summary tables use `[**Code**](path)` format for the first column.
